<article id="markdown-body">
  <div>%s</div>
</article>

<script src="https://cdnjs.cloudflare.com/ajax/libs/showdown/1.9.1/showdown.min.js" integrity="sha512-L03kznCrNOfVxOUovR6ESfCz9Gfny7gihUX/huVbQB9zjODtYpxaVtIaAkpetoiyV2eqWbvxMH9fiSv5enX7bw==" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.3/highlight.min.js" integrity="sha512-tHQeqtcNWlZtEh8As/4MmZ5qpy0wj04svWFK7MIzLmUVIzaHXS8eod9OmHxyBL1UET5Rchvw7Ih4ZDv5JojZww==" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@9.17.1/build/highlight.min.js"></script>
<script> hljs.initHighlightingOnLoad(); </script>
<script>
  showdown.extension('codehighlight', function() {
    function htmlunencode(text) {
      return (
        text
          .replace(/&amp;/g, '&')
          .replace(/&lt;/g, '<')
          .replace(/&gt;/g, '>')
      );
    }
    return [
      {
        type: 'output',
        filter: function (text, converter, options) {
          // use new shodown's regexp engine to conditionally parse codeblocks
          var left  = '<pre><code\\b[^>]*>',
            right = '</code></pre>',
            flags = 'g',
            replacement = function (wholeMatch, match, left, right) {
              // unescape match to prevent double escaping
              match = htmlunencode(match);
              return left + hljs.highlightAuto(match).value + right;
            };
          return showdown.helper.replaceRecursiveRegExp(text, replacement, left, right, flags);
        }
      }
    ];
  });
</script>

<script>
  function display() {
    showdown.setFlavor('github');
    let converter = new showdown.Converter({ extensions: ['codehighlight'] });
    converter.setOption('simpleLineBreaks', false);

    let md = document.querySelector('#markdown-body div');
    if (!md) return;

    let text = md.innerHTML;
    let newHTML = converter.makeHtml(text);

    md.innerHTML = newHTML;
  }

  display();
</script>

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.3/styles/github-gist.min.css" integrity="sha512-LcufBzA8yrkLJmMzmj3KYSM6tfPOxYdG2byxGbmRzHFSuP5wumxGcbVmmUXnkYpB3OqnHprnX54l7w19dpttlA==" crossorigin="anonymous" />
<style>
  body {
    background-color: #141414;
  }

  #markdown-body {
    background-color: #888;
    border: 2px solid #AAA;
    width: 800px;
    margin: auto;
    padding: 10px;
  }
</style>
